---
# ---------------------------------------------------------------------------
# START: modbus include file for HA-FoxESS-Modbus
# ---------------------------------------------------------------------------
# Supports RS-485 to USB, RS485 to Wifi/LAN and direct LAN connection for
# single phase H1, AC, AIO and KH series inverters

- name: FoxESSInverterModbus

  # ------------------------ USB connection  -------------------------------
  # Enter the port in secrets.yaml
  type: serial
  port: !secret foxess_inv1_tty
  baudrate: 9600
  bytesize: 8
  method: rtu
  parity: N
  stopbits: 1

  # ----------------------- LAN connection --------------------------------
  # Enter the IP address in secrets.yaml
  # Comment out the previous section and uncomment this section to use this
  #type: tcp
  #host: !secret foxess_inv1_ip_address
  #port: 502
  # uncomment this line when using a direct connection to the inverter
  #delay: 1
  # ---------------------------------------------------------------------------

  # list of modbus addresses to read
  sensors:
    - name: "Inverter Model"
      unique_id: foxess_inv1_inverter_model
      address: 30000 # also 10000
      input_type: holding
      slave: !secret foxess_inv1_slave
      count: 8
      data_type: string
      scan_interval: !secret scan_interval_static
    #- name: "Serial Number"
    #  unique_id: foxess_inv1_serial_number
    #  address: 10008 # 30008 is blank
    #  input_type: input
    #  slave: !secret foxess_inv1_slave
    #  count: 8
    #  data_type: string
    #  scan_interval: !secret scan_interval_static
    - name: "Master Version"
      unique_id: foxess_inv1_master_version
      address: 30016 # also 10016
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scale: 0.01
      precision: 2
      scan_interval: !secret scan_interval_static
    - name: "Slave Version"
      unique_id: foxess_inv1_slave_version
      address: 30017 # also 10017
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scale: 0.01
      precision: 2
      scan_interval: !secret scan_interval_static
    - name: "Manager Version"
      unique_id: foxess_inv1_manager_version
      address: 30018 # also 10018
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scale: 0.01
      precision: 2
      scan_interval: !secret scan_interval_static
    - name: "BMS Version"
      unique_id: foxess_inv1_bms_version
      address: 30019 # also 10019
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_static
    - name: "Battery 1 Version"
      unique_id: foxess_inv1_battery_1_version
      address: 30020 # also 10020
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_static
    - name: "Battery 2 Version"
      unique_id: foxess_inv1_battery_2_version
      address: 30021 # also 10021
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_static
    - name: "Battery 3 Version"
      unique_id: foxess_inv1_battery_3_version
      address: 30022 # also 10022
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_static
    - name: "Battery 4 Version"
      unique_id: foxess_inv1_battery_4_version
      address: 30023 # also 10023
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_static
    - name: "Battery 5 Version"
      unique_id: foxess_inv1_battery_5_version
      address: 30024 # also 10024
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_static
    - name: "Battery 6 Version"
      unique_id: foxess_inv1_battery_6_version
      address: 30025 # also 10025
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_static
    - name: "Battery 7 Version"
      unique_id: foxess_inv1_battery_7_version
      address: 30026 # also 10026
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_static
    - name: "Battery 8 Version"
      unique_id: foxess_inv1_battery_8_version
      address: 30027 # also 10027
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      scan_interval: !secret scan_interval_static

    - name: "PV1 Voltage"
      unique_id: foxess_inv1_pv1_voltage
      address: 31000 # also 11000
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: voltage
      unit_of_measurement: "V"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "PV1 Current"
      unique_id: foxess_inv1_pv1_current
      address: 31001 # also 11001
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: current
      unit_of_measurement: "A"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "PV1 Power"
      unique_id: foxess_inv1_pv1_power
      address: 31002 # also 11002
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
    - name: "PV2 Voltage"
      unique_id: foxess_inv1_pv2_voltage
      address: 31003 # also 11003
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: voltage
      unit_of_measurement: "V"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "PV2 Current"
      unique_id: foxess_inv1_pv2_current
      address: 31004 # also 11004
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: current
      unit_of_measurement: "A"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "PV2 Power"
      unique_id: foxess_inv1_pv2_power
      address: 31005 # also 11005
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      scan_interval: !secret scan_interval_high
    - name: "RVolt"
      unique_id: foxess_inv1_grid_voltage_R
      address: 31006 # also 11009
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: voltage
      unit_of_measurement: "V"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "RCurrent"
      unique_id: foxess_inv1_inv_current_R
      address: 31007 # also 11010
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: current
      unit_of_measurement: "A"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "RPower"
      unique_id: foxess_inv1_inv_power_R
      address: 31008 # also 11011
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
    - name: "RFreq"
      unique_id: foxess_inv1_grid_frequency
      address: 31009 # also 11014
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      unit_of_measurement: "Hz"
      device_class: frequency
      scale: 0.01
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "EPS RVolt"
      unique_id: foxess_inv1_eps_rvolt
      address: 31010 # also 11015
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: voltage
      unit_of_measurement: "V"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "EPS RCurrent"
      unique_id: foxess_inv1_eps_rcurrent
      address: 31011 # also 11016
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: current
      unit_of_measurement: "A"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "EPS RPower"
      unique_id: foxess_inv1_eps_rpower
      address: 31012 # also 11017
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
    - name: "EPS RFreq"
      unique_id: foxess_inv1_eps_frequency
      address: 31013 # also 11020
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: frequency
      unit_of_measurement: "Hz"
      scale: 0.01
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Grid CT"
      unique_id: foxess_inv1_grid_ct
      address: 31014 # also 11021
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
    - name: "CT2 Meter"
      unique_id: foxess_inv1_ct2
      address: 31015 # also 11022
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
    - name: "Load Power"
      unique_id: foxess_inv1_load_power
      address: 31016 # also 11023
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high

    - name: "InvTemp"
      unique_id: foxess_inv1_inverter_temperature
      address: 31018 # also 11024
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: temperature
      unit_of_measurement: "°C"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "AmbTemp"
      unique_id: foxess_inv1_ambient_temperature
      address: 31019 # also 11025
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: temperature
      unit_of_measurement: "°C"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "InvBatVolt"
      unique_id: foxess_inv1_inverter_battery_voltage
      address: 31020 # also 11006
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: voltage
      unit_of_measurement: "V"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "InvBatCurrent"
      unique_id: foxess_inv1_inverter_battery_current
      address: 31021 # also 11007
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: current
      unit_of_measurement: "A"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "InvBatPower"
      unique_id: foxess_inv1_battery_power
      address: 31022 # also 11008
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: power
      unit_of_measurement: "kW"
      scale: 0.001
      precision: 3
      state_class: measurement
      scan_interval: !secret scan_interval_high
    - name: "Battery Temp"
      unique_id: foxess_inv1_battery_temperature
      address: 31023 # also 11038
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: temperature
      unit_of_measurement: "°C"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "Battery SoC"
      unique_id: foxess_inv1_battery_soc
      address: 31024 # also 11036
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: battery
      unit_of_measurement: "%"
      state_class: measurement
      scan_interval: !secret scan_interval_low

    # -------------------------------------------------------------------------
    # Inverter energy meters
    # -------------------------------------------------------------------------

    - name: "Solar Energy Total"
      unique_id: foxess_inv1_solar_energy_total
      address: 32000 # also 11069
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint32
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total_increasing
      scan_interval: !secret scan_interval_low
    - name: "Solar Energy Today"
      unique_id: foxess_inv1_solar_energy_today
      address: 32002 # also 11071
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Battery Charge Total"
      unique_id: foxess_inv1_battery_charge_total
      address: 32003 # also 11072
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint32
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total_increasing
      scan_interval: !secret scan_interval_low
    - name: "Battery Charge Today"
      unique_id: foxess_inv1_battery_charge_today
      address: 32005 # also 11074
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Battery Discharge Total"
      unique_id: foxess_inv1_battery_discharge_total
      address: 32006 # also 11075
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint32
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total_increasing
      scan_interval: !secret scan_interval_low
    - name: "Battery Discharge Today"
      unique_id: foxess_inv1_battery_discharge_today
      address: 32008 # also 11077
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Feed In Energy Total"
      unique_id: foxess_inv1_feed_in_energy_total
      address: 32009 # also 11078
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint32
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total_increasing
      scan_interval: !secret scan_interval_low
    - name: "Feed In Energy Today"
      unique_id: foxess_inv1_feed_in_energy_today
      address: 32011 # also 11080
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Grid Consumption Energy Total"
      unique_id: foxess_inv1_grid_consumption_energy_total
      address: 32012 # also 11081
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint32
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total_increasing
      scan_interval: !secret scan_interval_low
    - name: "Grid Consumption Energy Today"
      unique_id: foxess_inv1_grid_consumption_energy_today
      address: 32014 # also 11083
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Total Yield Total"
      unique_id: foxess_inv1_total_yield_total
      address: 32015 # also 11084
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint32
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total_increasing
      scan_interval: !secret scan_interval_low
    - name: "Total Yield Today"
      unique_id: foxess_inv1_total_yield_today
      address: 32017 # also 11086
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Input Energy Total"
      unique_id: foxess_inv1_input_energy_total
      address: 32018 # also 11087
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint32
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total_increasing
      scan_interval: !secret scan_interval_low
    - name: "Input Energy Today"
      unique_id: foxess_inv1_input_energy_today
      address: 32020 # also 11089
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "Load Energy Total"
      unique_id: foxess_inv1_load_energy_total
      address: 32021 # also 11090
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint32
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total_increasing
      scan_interval: !secret scan_interval_low
    - name: "Load Energy Today"
      unique_id: foxess_inv1_load_energy_today
      address: 32023 # also 11092
      input_type: holding
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.1
      precision: 1
      state_class: total
      scan_interval: !secret scan_interval_low

    # -------------------------------------------------------------------------
    # BMS Input Registers only available via RS485 connection
    # these entities will be unavailable when using direct LAN connection
    # -------------------------------------------------------------------------

    - name: "BatVolt"
      unique_id: foxess_inv1_battery_voltage
      address: 11034
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: voltage
      unit_of_measurement: "V"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "BatCurrent"
      unique_id: foxess_inv1_battery_current
      address: 11035
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: current
      unit_of_measurement: "A"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "BMS kWh Remaining"
      unique_id: foxess_inv1_bms_kwh_remaining
      address: 11037
      slave: !secret foxess_inv1_slave
      input_type: input
      data_type: int16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.01
      precision: 2
      state_class: total
      scan_interval: !secret scan_interval_low
    - name: "BMS Charge Rate"
      unique_id: foxess_inv1_bms_charge_rate
      address: 11041
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: current
      unit_of_measurement: "A"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "BMS Discharge Rate"
      unique_id: foxess_inv1_bms_discharge_rate
      address: 11042
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: current
      unit_of_measurement: "A"
      state_class: measurement
      scale: 0.1
      precision: 1
      scan_interval: !secret scan_interval_medium
    - name: "BMS Cell Temp High"
      unique_id: foxess_inv1_bms_cell_temperature_high
      address: 11043
      input_type: input
      slave: !secret foxess_inv1_slave
      unit_of_measurement: "°C"
      data_type: int16
      device_class: temperature
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "BMS Cell Temp Low"
      unique_id: foxess_inv1_bms_cell_temperature_low
      address: 11044
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: temperature
      unit_of_measurement: "°C"
      scale: 0.1
      precision: 1
      state_class: measurement
      scan_interval: !secret scan_interval_low
    - name: "BMS Cell mV High"
      unique_id: foxess_inv1_bms_cell_mv_high
      address: 11045
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: voltage
      unit_of_measurement: "mV"
      state_class: measurement
      scan_interval: !secret scan_interval_medium
    - name: "BMS Cell mV Low"
      unique_id: foxess_inv1_bms_cell_mv_low
      address: 11046
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: int16
      device_class: voltage
      unit_of_measurement: "mV"
      state_class: measurement
      scan_interval: !secret scan_interval_medium

    - name: "BMS Cycle Count"
      unique_id: foxess_inv1_bms_cycle_count
      address: 11048
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      state_class: total_increasing
      scan_interval: !secret scan_interval_low
    - name: "BMS kWh Total"
      unique_id: foxess_inv1_bms_kwh_total
      address: 11049
      input_type: input
      slave: !secret foxess_inv1_slave
      data_type: uint16
      device_class: energy
      unit_of_measurement: "kWh"
      scale: 0.001
      precision: 3
      state_class: total_increasing
      scan_interval: !secret scan_interval_low

  # ---------------------------------------------------------------------------
  # END: modbus include file for HA-FoxESS-Modbus RS485 connection
  # ---------------------------------------------------------------------------
